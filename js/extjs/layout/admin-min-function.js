/**
 * madani
 * (c) 2009-2010 madaniyah.com
 *
 * $Author: Nihki Prihadi $
 * $Id: ext-admin-function.js
 */

function openActionDialog(a,b){var c=tree.getSelectionModel().getSelectedNode();switch(a){case"addfolder":ext_get("./admin/dms_foldermanager/add/parentGuid/"+c.id,500,250);break;case"renfolder":ext_get("./admin/dms_foldermanager/edit/folderGuid/"+c.id,500,250);break;case"delfolder":deleteFile(c);break;case"sharefolder":ext_get("./admin/dms_sharing/view/guid/"+c.id,480,470,"sharefolder");break}}function ext_get(b,c,a,d){dialog=new Ext.Window({id:d,title:"Website - Dialog",iconCls:"dialog",layout:"fit",autoLoad:{url:b,scripts:true},modal:true,width:c,height:a,maximizable:true,autoScroll:true});dialog.show()}function info(b,a){new Ext.ux.window.MessageWindow({title:b,html:a||"No information available",origin:{offY:-5,offX:-5},autoHeight:true,iconCls:"icon-info",help:false,hideFx:{delay:1000,mode:"standard"},listeners:{render:function(){}}}).show(Ext.getDoc())}function captureEvents(a){Ext.util.Observable.capture(a,function(b){console.info(b)},this)}function ext_get_iframe(a,d,j,c,i){var b=function(){Ext.getCmp("sites").activeTab.setSrc()},g=function(){try{Ext.getCmp("sites").activeTab.iframe.print()}catch(l){Ext.Msg.alert("Sorry","Print Failure!<br />"+l)}},k="/",f=function(){var m=k=location.href.indexOf("/")!=-1?"/":"\\";var l=location.href.split(m);l.pop();return l.join(m)},h=function(){var l=f().split(k);l.pop();return l.join(k)};var e=function(){return[{text:"Return",handler:function(){Ext.Msg.alert("Sorry","Under construction")}},"-",{text:"Print",handler:function(){Ext.Msg.alert("Sorry","Under construction")}}]};win=new Ext.Window({title:"Panel - Dialog",iconCls:"dialog",id:"paneldialog",layout:"fit",minimizable:false,maximizable:true,width:d,height:j,constrainHeader:true,collapsible:true,animCollapse:Ext.isIE,items:{xtype:"panel",layout:"fit",defaultType:"iframepanel",defaults:{closable:true,loadMask:{msg:"Loading Site..."},autoScroll:true,autoShow:true},items:[{id:c,title:i,frameConfig:{id:c},defaultSrc:a,tbar:e()}]}});win.show();Ext.EventManager.on(window,"beforeunload",function(){Ext.destroy(viewport,win)},window,{single:true})}function deleteFile(a){var b=tree.selModel.selNode;if(a.hasChildNodes()){Ext.MessageBox.show({title:"Confirm",msg:"Attention!! Are you sure you want to remove folder '"+a.text+"' and remove all its contents ?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.WARNING,fn:function(c){if(c=="yes"){var d=new Ext.data.Connection();d.on("beforerequest",function(){Ext.MessageBox.wait("Deleted "+a.text)});d.request({url:"./admin/dms_foldermanager/forcedelete",params:{node:a.id},callback:function(f,g,e){if(g){json=Ext.decode(e.responseText);if(json.success){tree.selModel.selNode.parentNode.removeChild(b);info("Success",json.message)}else{info("Failure",json.error)}}else{Ext.MessageBox.alert("Oops..",e.responseText)}}});d.on("requestcomplete",function(){Ext.MessageBox.hide()})}else{info("Notification","Deleted cancelled.")}}})}else{Ext.MessageBox.show({title:"Confirm",msg:"Are you sure you want to remove '"+a.text+"' ?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.WARNING,fn:function(c){if(c=="yes"){var d=new Ext.data.Connection();d.on("beforerequest",function(){Ext.MessageBox.wait("Deleted "+a.text)});d.request({url:"./admin/dms_foldermanager/delete",params:{node:a.id},callback:function(f,g,e){if(g){json=Ext.decode(e.responseText);if(json.success){tree.selModel.selNode.parentNode.removeChild(b);info("Success",json.message)}else{info("Failure",json.error)}}else{info("Error","Failed to connect to the server.")}}});d.on("requestcomplete",function(){Ext.MessageBox.hide()})}else{info("Notification","Deleted cancelled.")}}})}}function enableDnD(){Ext.grid.RowSelectionModel.prototype.rsmHandleMouseDown=Ext.grid.RowSelectionModel.prototype.handleMouseDown;Ext.grid.CheckboxSelectionModel.override({handleMouseDown:function(a,c,b){}});Ext.grid.RowSelectionModel.override({initEvents:function(){if(!this.grid.enableDragDrop&&!this.grid.enableDrag){this.grid.on("rowmousedown",this.rsmHandleMouseDown,this)}else{this.grid.on("rowclick",function(b,f,d){var c=d.getTarget();if(c.className!=="x-grid3-row-checker"){this.rsmHandleMouseDown(b,f,d);b.view.focusRow(f)}},this)}this.rowNav=new Ext.KeyNav(this.grid.getGridEl(),{up:function(c){if(!c.shiftKey){this.selectPrevious(c.shiftKey)}else{if(this.last!==false&&this.lastActive!==false){var b=this.last;this.selectRange(this.last,this.lastActive-1);this.grid.getView().focusRow(this.lastActive);if(b!==false){this.last=b}}else{this.selectFirstRow()}}},down:function(c){if(!c.shiftKey){this.selectNext(c.shiftKey)}else{if(this.last!==false&&this.lastActive!==false){var b=this.last;this.selectRange(this.last,this.lastActive+1);this.grid.getView().focusRow(this.lastActive);if(b!==false){this.last=b}}else{this.selectFirstRow()}}},scope:this});var a=this.grid.view;a.on("refresh",this.onRefresh,this);a.on("rowupdated",this.onRowUpdated,this);a.on("rowremoved",this.onRemove,this)}});Ext.dd.DragSource.override({onBeforeDrag:function(a,b){return(a.selections)?(a.selections.length>0):""}})};