function ext_init(){Ext.Ajax.timeout=60000;Ext.Ajax.on("requestexception",function(ab,Z,aa){switch(Z.status){case 401:delete aa.failure;Ext.Msg.alert("Error","Your Session has expired please login again",function(){window.location.reload()},this);break;case 400:delete aa.failure;Ext.Msg.alert("Error","Invalid Server function call please login and try again",function(){window.location.reload()},this);break;case 503:delete aa.failure;Ext.Msg.alert("Error","Unable to connect to Mail Server please login and try again",function(){window.location.reload()},this);break}},this);Ext.state.Manager.setProvider(new Ext.state.CookieProvider);Ext.BLANK_IMAGE_URL="./js/extjs/resources/images/default/s.gif";var X=Ext.get("loading");var S=Ext.get("loading-mask");S.setOpacity(0.8);S.shift({xy:X.getXY(),width:X.getWidth(),height:X.getHeight(),remove:true,duration:2,opacity:0.3,easing:"bounceOut",callback:function(){X.fadeOut({duration:0.2,remove:true})}});profile=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./services/catalog/fetch-profile-in-folder"}),reader:new Ext.data.JsonReader({root:"profile",totalProperty:"totalCount",id:"guid"},[{name:"guid"},{name:"title"}]),remoteSort:true});folder=new Ext.data.GroupingStore({proxy:new Ext.data.HttpProxy({url:"./services/folder/fetch-folder"}),reader:new Ext.data.JsonReader({root:"folder",totalProperty:"totalCount",id:"guid"},[{name:"guid"},{name:"title"}]),remoteSort:true});store=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./services/catalog/fetch-catalogs-in-folder"}),reader:new Ext.data.JsonReader({root:"catalogs",totalProperty:"totalCount",id:"guid"},["title","createdby","modifiedby",{name:"createdDate",mapping:"createdDate"},{name:"guid",mapping:"guid"},"subtitle","profile_column","status"]),remoteSort:true});function R(aa,ab,Z){return String.format('<div class="topic"><b>{0}</b><br /><span class="author">by {1}</span></div>',aa,Z.data.createdby,Z.id,Z.data.guid)}function x(aa,ab,Z){if(aa.indexOf("File")>-1){return String.format('<div class="topic"><span style="color:green;"><b>{0}</b></span></div>',aa,Z.id,Z.data.guid)}else{return String.format('<div class="topic"><b>{0}</b></div>',aa,Z.id,Z.data.guid)}}function q(Z){if(Z=="publish_y"){return'<img src="./js/extjs/resources/images/default/silk/icons/publish_y.png">'}else{if(Z=="publish_g"){return'<img src="./js/extjs/resources/images/default/silk/icons/publish_g.png">'}else{if(Z=="publish_r"){return'<img src="./js/extjs/resources/images/default/silk/icons/publish_r.png">'}else{if(Z=="publish_x"){return'<img src="./js/extjs/resources/images/default/silk/icons/publish_x.png">'}else{if(Z=="disabled"){return'<img src="./js/extjs/resources/images/default/silk/icons/disabled.png">'}}}}}}function O(aa,ab,Z){return String.format('<span class="post-date">{0}</span><br/>modifiedBy {1}',aa,Z.data.modifiedby)}Ext.ux.grid.PagingRowNumberer=Ext.extend(Ext.grid.RowNumberer,{renderer:function(ac,af,aa,ag,ad,ab){if(this.rowspan){af.cellAttr='rowspan="'+this.rowspan+'"'}var ae=ab.lastOptions;var Z=ae?ae.params:null;return((Z&&Z.start)?Z.start:0)+ag+1}});var Q=Ext.grid;var u=new Q.CheckboxSelectionModel();var w=new Ext.ux.grid.PagingRowNumberer({header:"No.",width:30});var G=new Q.ColumnModel([u,w,{id:"catalog",header:"Title",dataIndex:"title",width:370,sortable:true,renderer:R},{header:"Section",dataIndex:"profile_column",width:50,sortable:true},{header:"Published",dataIndex:"status",align:"center",width:30,sortable:true,renderer:q},{header:"Created on",dataIndex:"createdDate",width:130,sortable:true,renderer:O}]);var B=new Ext.ux.PagingToolbar({pageSize:25,store:store,displayInfo:true,displayMsg:"Displaying topics {0} - {1} of {2}",emptyMsg:"No data to display"});comboProfile=new Ext.form.ComboBox({id:"comboprofile",typeAhead:false,triggerAction:"all",emptyText:"Select a profile...",lazyRender:true,store:profile,displayField:"title",valueField:"guid"});var I=new Ext.ux.form.LovCombo({id:"comboctf",hideOnSelect:false,store:folder,triggerAction:"all",emptyText:"Copy to Folder...",disabled:true,displayField:"title",valueField:"guid"});mtf=new Ext.ux.form.LovCombo({id:"combomtf",hideOnSelect:false,store:folder,triggerAction:"all",emptyText:"Move to Folder...",disabled:true,displayField:"title",valueField:"guid"});grid=new Q.GridPanel({region:"center",id:"catalog-grid",store:store,cm:G,sm:u,bbar:B,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,getRowClass:function(Z,ac,ab,aa){if(this.showPreview){ab.body="<p> "+Z.data.subtitle+"</p>";return"x-grid3-row-expanded"}return"x-grid3-row-collapsed"}},tbar:[{text:"Open All",ToolTip:{title:"Open All",text:"Opens all item in tabs"},iconCls:"tabs",handler:L},"-",comboProfile,"-",{text:"Delete catalog",icon:"./js/extjs/resources/images/default/silk/icons/bin_empty.png",cls:"x-btn-text-icon",tooltip:"Click to delete selected rows",handler:function(){var Z=grid.selModel.selections.keys;if(Z.length>0){Ext.MessageBox.confirm("Confirm","Do you really want to delete selection?",function(aa){if(aa=="yes"){var ab=grid.selModel.getSelections();for(j=0;j<grid.selModel.getCount();j++){var ac=new Ext.data.Connection();ac.on("beforerequest",function(){Ext.MessageBox.wait("delete catalog ["+ab[j].json.title+"]")});ac.request({url:"./admin/api_catalog/delete/format/json",params:{guid:ab[j].json.guid},callback:function(ae,af,ad){if(af){json=Ext.decode(ad.responseText);if(json.success){store.reload();info("success",json.message)}else{Ext.Msg.alert("Failure",json.error)}}else{Ext.Msg.alert("Error","Failed to connect to the server.")}}});ac.on("requestcomplete",function(){Ext.MessageBox.hide()})}}})}else{Ext.MessageBox.alert("Oops ...","Please select at least one item to delete")}}},{text:"Refresh",icon:"./js/extjs/resources/images/default/silk/icons/database_refresh.png",cls:"x-btn-text-icon",tooltip:"Click to Refresh",handler:function(){store.reload()}},"-",{text:"Catalog",iconCls:"mfolder",menu:{items:[{text:"Copy to Folder",icon:"./js/extjs/resources/images/default/silk/icons/folder_add.png",cls:"x-btn-text-icon",tooltip:"Click to add to folder",handler:function(){var Z=grid.selModel.selections.keys;if(Z.length>0){ext_get("./admin/dms_catalogmanager/manage-folder",400,105)}else{Ext.MessageBox.alert("Oops ...","Please select at least one item")}}},{text:"Move to Folder",icon:"./js/extjs/resources/images/default/silk/icons/folder_go.png",cls:"x-btn-text-icon",tooltip:"Click to move catalog",handler:function(){var aa=tree.getSelectionModel().getSelectedNode().id;var Z=grid.selModel.selections.keys;if(Z.length>0){ext_get("./admin/dms_catalogmanager/manage-folder-move",400,105)}else{Ext.MessageBox.alert("Oops ...","Please select at least one item")}}},{text:"Indexing",tooltip:"Click to index catalog",handler:function(){var Z=grid.selModel.selections.keys;if(Z.length>0){Ext.MessageBox.confirm("Confirm","Index catalog?",function(aa){if(aa=="yes"){var ab=grid.selModel.getSelections();for(j=0;j<grid.selModel.getCount();j++){var ac=new Ext.data.Connection();ac.on("beforerequest",function(){Ext.MessageBox.wait("index catalog ["+ab[j].json.title+"]")});ac.request({url:"./admin/widgets_indexing/indexing-catalog/format/json",params:{guid:ab[j].json.guid,profile:"peraturan"},callback:function(ae,ag,ad){if(ag){json=Ext.decode(ad.responseText);if(json.success){store.reload()}else{try{Ext.Msg.alert("Failure",json.error.message)}catch(af){Ext.Msg.alert("Failure",json.error)}}}else{Ext.Msg.alert("Error","Failed to connect to the server.")}}});ac.on("requestcomplete",function(){Ext.MessageBox.hide()})}}})}else{Ext.MessageBox.alert("Oops ...","Please select at least one item")}}}]}},"-",{text:"Laporan",iconCls:"report",menu:{items:[{text:"Bahan masuk",handler:function(){ext_get("./admin/dms_catalogmanager/report/wr/msk",420,145,"dialog_window1")}},{text:"Bahan terbit",handler:function(){ext_get("./admin/dms_catalogmanager/report/wr/tbt",420,145,"dialog_window1")}},{text:"Kategori",handler:function(){ext_get("./admin/dms_catalogmanager/report-kategori",420,175,"dialog_window1")}},{text:"Author",handler:function(){ext_get("./admin/dms_catalogmanager/report-author",420,145,"dialog_window1")}}]}},"-",{iconCls:"exprt",tooltip:"Export to excel",handler:function(){var aa=grid.selModel.selections.keys;var Z=Ext.encode(aa);if(aa.length>0){Ext.MessageBox.confirm("Confirm","Export selection?",function(ab){if(ab=="yes"){window.location.href="./admin/api_export/report.by.selection/format/excel/guid/"+Z}})}else{Ext.MessageBox.alert("Oops ...","Please select at least one item to export")}}},"-",{pressed:true,enableToggle:true,text:"&nbsp;Preview",tooltip:"View a short summary of each post in the list",iconCls:"summary",toggleHandler:g}],selModel:new Q.RowSelectionModel({singleSelect:false}),layout:"fit",forceFit:"fit",ddGroup:"TreeDD",loadMask:true,enableColLock:false,enableDragDrop:true,frame:false,border:true});store.load();dssearch=new Ext.data.Store({proxy:new Ext.data.HttpProxy({url:"./services/catalog/search"}),reader:new Ext.data.JsonReader({root:"search",totalProperty:"totalCount",id:"guid"},["title",{name:"guid",mapping:"guid"},"subtitle","folderGuid"])});sfind=new Ext.data.SimpleStore({id:"selectit",fields:["pns","cval"],data:[["Artikel","1"],["Klinik","2"],["Peraturan","3"]]});var v=new Ext.form.ComboBox({emptyText:"-- Please choose --",mode:"local",triggerAction:"all",selectOnFocus:true,store:sfind,valueField:"cval",displayField:"pns"});var H=new Q.CheckboxSelectionModel();var U=new Ext.ux.grid.PagingRowNumberer({header:"No.",width:30});var W=new Q.ColumnModel([H,U,{id:"catalog",header:"Title",dataIndex:"title",width:370,renderer:x}]);var J=new Ext.ux.PagingToolbar({pageSize:25,store:dssearch,displayInfo:true,displayMsg:"Displaying topics {0} - {1} of {2}",emptyMsg:"No data to display"});var l=new Ext.menu.Menu({id:"mainMenuSearch",items:[{text:"Delete catalog",icon:"./js/extjs/resources/images/default/silk/icons/bin_empty.png",cls:"x-btn-text-icon",tooltip:"Click to delete selected rows",handler:function(){var Z=gridsearch.selModel.selections.keys;if(Z.length>0){Ext.MessageBox.confirm("Confirm","Do you really want to delete selection?",function(aa){if(aa=="yes"){var ab=gridsearch.selModel.getSelections();for(j=0;j<gridsearch.selModel.getCount();j++){var ac=new Ext.data.Connection();ac.on("beforerequest",function(){Ext.MessageBox.wait("delete catalog ["+ab[j].json.title+"]")});ac.request({url:"./admin/api_catalog/delete/format/json",params:{guid:ab[j].json.guid},callback:function(ae,af,ad){if(af){json=Ext.decode(ad.responseText);if(json.success){store.reload()}else{Ext.Msg.alert("Failure",json.error)}}else{Ext.Msg.alert("Error","Failed to connect to the server.")}}});ac.on("requestcomplete",function(){Ext.MessageBox.hide()})}}})}else{Ext.MessageBox.alert("Oops ...","Please select at least one item to delete")}}},{text:"Refresh",icon:"./js/extjs/resources/images/default/silk/icons/database_refresh.png",cls:"x-btn-text-icon",tooltip:"Click to Refresh",handler:function(){dssearch.reload()}},"-",{text:"Catalog",iconCls:"mfolder",menu:{items:[{text:"Copy to Folder",icon:"./js/extjs/resources/images/default/silk/icons/folder_add.png",cls:"x-btn-text-icon",tooltip:"Click to add to folder",handler:function(){var Z=gridsearch.selModel.selections.keys;if(Z.length>0){ext_get("./admin/dms_catalogmanager/manage-folder",400,105)}else{Ext.MessageBox.alert("Oops ...","Please select at least one item")}}},{text:"Move to Folder",icon:"./js/extjs/resources/images/default/silk/icons/folder_go.png",cls:"x-btn-text-icon",tooltip:"Click to move catalog",handler:function(){var aa=tree.getSelectionModel().getSelectedNode().id;var Z=gridsearch.selModel.selections.keys;if(Z.length>0){ext_get("./admin/dms_catalogmanager/manage-folder-move",400,105)}else{Ext.MessageBox.alert("Oops ...","Please select at least one item")}}}]}}]});var K=new Ext.form.TextField({name:"query",emptyText:"Search here...",width:180,fireKey:function(Z){if(Z.getKey()==Z.ENTER){var aa=this.getValue();if(aa.length>1){dssearch.baseParams={query:aa};dssearch.load({params:{start:0,limit:25,query:aa},callback:function(ad,ab,ac){if(ac){Ext.Ajax.request({url:"./services/catalog/suggestioncollation",params:{collation:aa},callback:function(ag,ah,af){if(ah){var ae=Ext.decode(af.responseText);if(ae.success==true){Ext.MessageBox.show({title:"Suggestion",msg:"Did you mean: <b>'"+ae.collation+"'</b> ?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(ai){if(ai=="yes"){dssearch.baseParams={query:ae.collation};dssearch.load({params:{start:0,limit:25,query:ae.collation}})}else{dssearch.load()}}})}}}})}else{Ext.Msg.alert("Notification","Failed to connect to the server!\nTry to check Solr service.")}}})}else{dssearch.clearFilter()}}}});gridsearch=new Q.GridPanel({region:"center",id:"catalog-search-grid",store:dssearch,cm:W,sm:H,bbar:J,viewConfig:{forceFit:true,enableRowBody:true,showPreview:true,getRowClass:function(Z,ac,ab,aa){if(this.showPreview){ab.body="<p> "+Z.data.subtitle+" </p>";return"x-grid3-row-expanded"}return"x-grid3-row-collapsed"}},tbar:[{text:"Open All",ToolTip:{title:"Open All",text:"Opens all item in tabs"},iconCls:"tabs",handler:V},"-",{text:"Master",iconCls:"master",menu:l},"-",{pressed:true,enableToggle:true,text:"&nbsp;Preview",tooltip:"View a short summary of each post in the list",iconCls:"summary",toggleHandler:h},"-",K,v,new Ext.Toolbar.Button({text:"Go",iconCls:"find",handler:function(Z,ab){var ac=K.getValue();var aa=v.getValue();if(ac.length>1){dssearch.baseParams={query:ac,qbox:aa};dssearch.load({params:{start:0,limit:25,query:ac,qbox:aa},callback:function(af,ad,ae){if(ae){Ext.Ajax.request({url:"./services/catalog/suggestioncollation",params:{collation:ac},callback:function(ai,aj,ah){if(aj){var ag=Ext.decode(ah.responseText);if(ag.success==true){Ext.MessageBox.show({title:"Suggestion",msg:"Did you mean: <b>'"+ag.collation+"'</b> ?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.QUESTION,fn:function(ak){if(ak=="yes"){dssearch.baseParams={query:ag.collation};dssearch.load({params:{start:0,limit:25,query:ag.collation}})}else{dssearch.load()}}})}}}})}else{Ext.Msg.alert("Notification","Failed to connect to the server!\nTry to check Solr service.")}}})}else{dssearch.clearFilter()}}})],selModel:new Q.RowSelectionModel({singleSelect:false}),layout:"fit",forceFit:"fit",ddGroup:"TreeDD",loadMask:true,enableColLock:false,enableDragDrop:true,frame:false,border:true});dssearch.load();enableDnD();Ext.getCmp("comboprofile").on("select",function(aa){var Z=tree.getSelectionModel().getSelectedNode();ext_get("./admin/dms_catalogmanager/add/profileGuid/"+aa.getValue()+"/folderGuid/"+Z.id,750,500)}.createDelegate(this));function g(aa,ab){var Z=Ext.getCmp("catalog-grid").getView();Z.showPreview=ab;Z.refresh()}function h(aa,ab){var Z=Ext.getCmp("catalog-search-grid").getView();Z.showPreview=ab;Z.refresh()}var E=new Ext.Panel({id:"preview",region:"south",autoScroll:true,tbar:[{id:"tab",text:"View in New Tab",iconCls:"new-tab",disabled:true,handler:m},"-",{id:"catalog_action",text:"Catalog",iconCls:"catalog",disabled:true,menu:new Ext.menu.Menu({items:[{text:"Edit",handler:function(){ext_get("./admin/dms_catalogmanager/edit/catalogGuid/"+grid.getSelectionModel().getSelected().data.guid,750,500)}},{text:"Upload File(s)",handler:function(){ext_get("./admin/dms_fileuploader/add/catalogGuid/"+grid.getSelectionModel().getSelected().data.guid,580,430)}},{text:"Add Relation",iconCls:"relation",handler:function(){var Z=grid.selModel.selections.keys;if(Z.length>0){ext_get("./admin/widgets_relation/viewsearch/guid/"+Z,830,500,"viewsearch")}else{Ext.MessageBox.alert("Oops ...","Please select at least one item")}}}]})}]});var A=new Ext.Panel({id:"previewsearch",region:"south",autoScroll:true,tbar:[{id:"tab_search",text:"View in New Tab",iconCls:"new-tab",disabled:true,handler:f},"-",{id:"catalog_search_action",text:"Catalog",iconCls:"catalog",disabled:true,menu:new Ext.menu.Menu({items:[{text:"Edit",handler:function(){ext_get("./admin/dms_catalogmanager/edit/catalogGuid/"+gridsearch.getSelectionModel().getSelected().data.guid,750,500)}},{text:"Upload File(s)",handler:function(){ext_get("./admin/dms_fileuploader/add/catalogGuid/"+gridsearch.getSelectionModel().getSelected().data.guid,580,430)}},{text:"Add Relation",iconCls:"relation",handler:function(){var Z=gridsearch.selModel.selections.keys;if(Z.length>0){ext_get("./admin/widgets_relation/viewsearch/guid/"+Z,820,500,"viewsearch")}else{Ext.MessageBox.alert("Oops ...","Please select at least one item")}}}]})}]});grid.on("rowcontextmenu",function(Z,ac,ab){var aa=ab.getXY();rowRecord=store.getAt(ac);ab.stopEvent();Y.showAt([aa[0],aa[1]])});grid.on("rowclick",function(ab,ae,ad){var aa=store.data.items[ae].id;var ac=tree.getSelectionModel().getSelectedNode();var Z=E.topToolbar.items;Z.get("tab").enable();Z.get("catalog_action").enable();mtf.enable();E.load({url:"./admin/browser/view-in-new-tab",params:{catalogGuid:aa,folderGuid:ac.id},scripts:true,nocache:false})});gridsearch.on("rowclick",function(Z,ae,ad){var ac=dssearch.data.items[ae].id;var aa=Z.getStore().getAt(ae);var ab=A.topToolbar.items;ab.get("tab_search").enable();ab.get("catalog_search_action").enable();A.load({url:"./admin/browser/view-in-new-tab",params:{catalogGuid:ac,folderGuid:aa.get("folderGuid")},scripts:true,nocache:false})});grid.on("rowdblclick",m);gridsearch.on("rowdblclick",f);var Y=new Ext.menu.Menu("mainGridRowContext");Y.add({text:"Edit",handler:function(){ext_get("./admin/dms_catalogmanager/edit/catalogGuid/"+rowRecord.id,750,500)}},{text:"Upload File(s)",handler:function(){ext_get("./admin/dms_fileuploader/add/catalogGuid/"+rowRecord.id,580,430)}},{text:"Add Relation",iconCls:"relation",handler:function(){ext_get("./admin/widgets_relation/viewsearch/guid/"+rowRecord.id,830,500,"viewsearch")}});var e=new Ext.Toolbar("header-toolbar",{height:24});e.add({text:"Reading pane",id:"read_panel",tooltip:"click to preview right",iconCls:"preview-right",menu:{id:"reading-menu",width:100,items:[{text:"Bottom",checked:true,group:"rp-group",checkHandler:r,iconCls:"preview-bottom"},{text:"Right",checked:false,group:"rp-group",checkHandler:r,tooltip:"Click to preview right",iconCls:"preview-right"},{text:"Hide",checked:false,group:"rp-group",checkHandler:r,tooltip:"Click to preview hide",iconCls:"preview-hide"}]}},"-",{text:"Site",menu:{items:[{text:"Global configuration",iconCls:"config",handler:function(){ext_get("./admin/setting_manager/setting",700,500)}},{text:"Indexing",menu:{items:[{text:"Empty index",disabled:true,handler:function(){Ext.MessageBox.confirm("Confirm","Do you really want to empty index?",function(Z){if(Z=="yes"){var aa=new Ext.data.Connection();aa.on("beforerequest",function(){Ext.MessageBox.wait("Empty index")});aa.request({url:"./admin/widgets_indexing/index/format/json",callback:function(ac,ad,ab){if(ad){json=Ext.decode(ab.responseText);if(json.success){store.reload()}}else{Ext.Msg.alert("Error","Failed to connect to the server.")}}});aa.on("requestcomplete",function(){Ext.MessageBox.hide()})}})}},{text:"Indexing Catalog",handler:function(){ext_get("./admin/widgets_indexing/index",1000,500,"dialog_indexing")}}]}},{text:"Preview",iconCls:"dialog",menu:{items:[{text:"In New Window",iconCls:"dialog",handler:function(){window.open("./")}}]}},{text:"User Manager",iconCls:"user",menu:{items:[{text:"Access Control",icon:"./js/extjs/resources/images/default/silk/icons/group.png",cls:"x-btn-text-icon",tooltip:"Click to Set ACL",handler:function(){ext_get_iframe("./phpgacl/admin/acl_admin.php",1000,500,"dialog_access_control","Access Control List")}}]}}]}},"-");var s=new Ext.menu.Menu({id:"home_menu",items:[{text:"Catalog",iconCls:"mfolder",menu:{items:[{text:"Indexing catalog",icon:"./js/extjs/resources/images/default/silk/icons/server_link.png",cls:"x-btn-text-icon",tooltip:"Click to indexing catalog",handler:function(){Ext.Ajax.on("beforerequest",function(){Ext.MessageBox.wait("Indexing catalog...")});Ext.Ajax.request({url:"../admin/catalog/catalog-index-updater",failure:function(Z,aa){Ext.MessageBox.alert("Warning","Oops...")},success:function(Z,aa){var ab=Ext.util.JSON.decode(Z.responseText);Ext.MessageBox.alert("Status",ab.message)}});Ext.Ajax.on("requestcomplete",function(){Ext.MessageBox.hide()})}},{text:"Optimizing index catalog",icon:"./js/extjs/resources/images/default/silk/icons/folder_add.png",cls:"x-btn-text-icon",tooltip:"Click to optimizing index catalog",handler:function(){Ext.Ajax.on("beforerequest",function(){Ext.MessageBox.wait("Optimizing catalog...")});Ext.Ajax.request({url:"../admin/catalog/catalog-index-optimizer",failure:function(Z,aa){Ext.MessageBox.alert("Warning","Oops...")},success:function(Z,aa){var ab=Ext.util.JSON.decode(Z.responseText);Ext.MessageBox.alert("Status",ab.message)}});Ext.Ajax.on("requestcomplete",function(){Ext.MessageBox.hide()})}}]}}]});tabpanel=new Ext.TabPanel({region:"center",resizeTabs:true,minTabWidth:80,deferredRender:false,activeTab:0,enableTabScroll:true,monitorResize:true,border:false,autoScroll:true,layoutOnTabChange:true,plugins:new Ext.ux.TabCloseMenu(),items:[{title:"Home",iconCls:"home",contentEl:"center1",tbar:[{text:"Master",iconCls:"master",menu:s}]},{id:"main-view",layout:"border",title:"Catalog",iconCls:"catalog",hideMode:"offsets",items:[grid,{id:"bottom-preview",layout:"fit",height:250,split:true,border:false,region:"south",items:E},{id:"right-preview",layout:"fit",border:false,region:"east",width:400,split:true,hidden:true}]},{id:"search-grid",title:"Search",iconCls:"find",layout:"border",hideMode:"offsets",items:[gridsearch,{id:"bottom-search-preview",layout:"fit",height:250,split:true,border:false,region:"south",items:A},{id:"right-search-preview",layout:"fit",border:false,region:"east",width:400,split:true,hidden:true}]}]});var p=new Ext.Toolbar({height:24});var P=new Ext.Viewport({id:"viewport",layout:"border",items:[{region:"north",contentEl:"north",height:49,bbar:p},{region:"west",id:"west-panel",title:"General Settings",iconCls:"gs",split:true,width:210,collapsible:true,layout:"accordion",layoutConfig:{animate:true},items:[{contentEl:"west",title:"Folder Navigation",id:"tree-div",border:false,iconCls:"nav"},{contentEl:"info",title:"Details Information",iconCls:"dei"},{contentEl:"calendar",title:"Calendar",iconCls:"calendar"},{contentEl:"legend",title:"Legend",iconCls:"legend"}]},new Ext.Panel({region:"center",margins:"0 0 0 -5",border:false,layout:"card",layoutConfig:{deferredRender:false},activeItem:0,items:[tabpanel]})]});authButton=new Ext.Toolbar.Button({id:"tb_authentication",icon:"./js/extjs/resources/images/default/custom/logout.gif",text:"&nbsp;Logout",cls:"x-btn-text-icon",tooltip:"Logout",handler:function(){var Z=Ext.MessageBox.wait("Please Wait...","Logging Out...",{text:"Logging Out..."});window.location.href="./identity/logout"}});e.addItem(authButton);registerButton=new Ext.Toolbar.Button({id:"tb_register",icon:"./js/extjs/resources/images/default/custom/users.png",text:"&nbsp;&nbsp;Signup",cls:"x-btn-text-icon",tooltip:"Register",handler:function(){ext_get("./admin/membership_manager/signup",700,500)}});e.addItem(registerButton);comboTheme=new Ext.ux.ThemeCombo();comboTheme.on("select",function(Z){Ext.util.CSS.swapStyleSheet("theme",Z.getValue());if(Ext.state.Manager.getProvider()){Ext.state.Manager.set("theme",Z.getValue())}}.createDelegate(this));e.setHeight(28);e.addFill();e.addText("Theme:");e.addSpacer();e.addSpacer();e.addField(comboTheme);e.add("-");e.addElement("datenow");e.addSpacer();e.addSpacer();e.add("-");e.addElement("clock");p.addElement("chdir");var b=new Ext.menu.Menu("mainContext");b.add(new Ext.menu.Item({id:"reload",icon:"./js/extjs/resources/images/default/silk/icons/arrow_refresh.png",text:"Reload (Ctrl+E)",handler:z}),new Ext.menu.Item({id:"exp",icon:"./js/extjs/resources/images/default/custom/expand-all.gif",text:"Expand All (Ctrl+&nbsp;&rarr;)",handler:z}),new Ext.menu.Item({id:"coll",icon:"./js/extjs/resources/images/default/custom/collapse-all.gif",text:"Collapse All (Ctrl+&nbsp;&larr;)",handler:z}),new Ext.menu.Separator(),new Ext.menu.Item({id:"renfolder",icon:"./js/extjs/resources/images/default/silk/icons/pencil.png",text:"Rename (F2)",handler:function(){b.hide();openActionDialog("renfolder")}}),new Ext.menu.Item({id:"delfolder",icon:"./js/extjs/resources/images/default/silk/icons/cross.png",text:"Delete (Delete Key)",handler:function(){b.hide();openActionDialog("delfolder")}}),new Ext.menu.Item({id:"addfolder",icon:"./js/extjs/resources/images/default/silk/icons/folder_add.png",text:"New folder ... (Ctrl+N)",handler:function(){b.hide();openActionDialog("addfolder")}}),new Ext.menu.Separator(),new Ext.menu.Item({id:"sharing_folder",icon:"./js/extjs/resources/images/default/silk/icons/bullet_wrench.png",disabled:true,text:"Share this folder",handler:function(){b.hide();openActionDialog("sharefolder")}}),new Ext.menu.Separator(),new Ext.menu.Item({id:"upload",text:"Upload file",disabled:true,handler:function(){var Z=tree.getSelectionModel().getSelectedNode();b.hide();getDialog("../../app/servers/upload/manager/uploader","gallery",Z.id)}}),new Ext.menu.Separator(),new Ext.menu.Item({id:"export",text:"Export file",iconCls:"exprt",handler:function(){var Z=tree.getSelectionModel().getSelectedNode();b.hide();Ext.MessageBox.confirm("Confirm","Export selection?",function(aa){if(aa=="yes"){window.location.href="./admin/api_export/peraturan/format/excel/folderGuid/"+Z.id}})}}),new Ext.menu.Separator(),new Ext.menu.Item({id:"doc",text:"Download document",iconCls:"download",handler:function(){var Z=tree.getSelectionModel().getSelectedNode();b.hide();ext_get("./admin/dms_filedownloader/browse/folderGuid/"+Z.id,580,430)}}));tree=new Ext.tree.TreePanel({el:"tree-div",autoScroll:true,animate:true,loader:new Ext.tree.TreeLoader({dataUrl:"./services/folder/fetch-children",baseParams:{parentGuid:"root"}}),enableDD:true,ddGroup:"TreeDD",timeout:90000,containerScroll:true});tree.on("dblclick",M);tree.on("contextmenu",d);tree.on("beforenodedrop",function(Z){dropEvent=Z;t(Z)});tree.on("beforemovenode",function(){return false});var T=tree.getSelectionModel();T.on("selectionchange",k);var C=new Ext.tree.AsyncTreeNode({text:"Root",draggable:false,id:"root"});tree.setRootNode(C);tree.render();C.expand(false,true);var F=new Ext.KeyMap("tree-div",[{key:69,ctrl:true,stopEvent:true,scope:this,fn:function(Z,ab){var ac=tree.getSelectionModel();var aa=ac.getSelectedNode();if(aa){aa=aa.isLeaf()?aa.parentNode:aa;ac.select(aa);aa.reload()}}},{key:39,ctrl:true,stopEvent:true,scope:this,fn:function(Z,ab){var ac=tree.getSelectionModel();var aa=ac.getSelectedNode();if(aa&&!aa.isLeaf()){ac.select(aa);aa.expand.defer(1,aa,[true])}}},{key:37,ctrl:true,scope:this,stopEvent:true,fn:function(Z,ab){var ac=tree.getSelectionModel();var aa=ac.getSelectedNode();if(aa&&!aa.isLeaf()){ac.select(aa);aa.collapse.defer(1,aa,[true])}}},{key:113,scope:this,fn:function(Z,ab){var ac=tree.getSelectionModel();var aa=ac.getSelectedNode();if(aa){ab.stopEvent();openActionDialog("renfolder")}}},{key:46,stopEvent:true,scope:this,fn:function(Z,ab){var ac=tree.getSelectionModel();var aa=ac.getSelectedNode();if(aa){openActionDialog("delfolder")}}},{key:78,ctrl:true,scope:this,stopEvent:true,fn:function(Z,ab){var ac=tree.getSelectionModel();var aa=ac.getSelectedNode();if(aa){ab.stopEvent();openActionDialog("addfolder")}}}]);var a=new Ext.menu.Menu({id:"copyCtx",items:[{id:"copy",icon:"./js/extjs/resources/images/default/custom/editcopy.png",text:"Copy",handler:function(){a.hide();c("copy")}},{id:"copysearch",icon:"./js/extjs/resources/images/default/custom/editcopy.png",text:"Copy from Search",handler:function(){a.hide();y("copy")}},{id:"move",icon:"./js/extjs/resources/images/default/custom/move.png",text:"Move",handler:function(){a.hide();c("move")}},{id:"movesearch",icon:"./js/extjs/resources/images/default/custom/move.png",text:"Move from Search",handler:function(){a.hide();y("move")}},"-",{id:"cancel",icon:"./js/extjs/resources/images/default/custom/cancel.png",text:"Cancel",handler:function(){a.hide()}}]});function c(ae){var aa=dropEvent.data.selections,ac=[];if(aa){var ad=grid.selModel.selections.keys;if(ad.length>0){var Z=grid.selModel.getSelections();var af=grid.selModel.getCount();for(i=0;i<af;i++){var ab=new Ext.data.Connection();ab.on("beforerequest",function(){Ext.MessageBox.wait(ae+" catalog ["+aa[i].data.title+"] to folder ["+dropEvent.target.text+"]")});ab.request({url:"./admin/api_folder/copy-move-items/format/json",params:{selitem:Z[i].json.guid,folderGuid:tree.getSelectionModel().getSelectedNode().id,targetGuid:dropEvent.target.id,act:ae,option:"grid"},callback:function(ah,ai,ag){if(ai){json=Ext.decode(ag.responseText);if(json.success){store.reload();info("Success",json.message)}else{Ext.Msg.alert("Failure",json.error)}}else{Ext.Msg.alert("Error","Failed to connect to the server.")}}});ab.on("requestcomplete",function(){Ext.MessageBox.hide()})}}}else{if(dropEvent.data.node){var ab=new Ext.data.Connection();ab.request({url:"./admin/api_folder/copy-move-items/format/json",params:{folderGuid:dropEvent.data.node.id,targetGuid:dropEvent.target.id,act:ae,option:"tree"},callback:function(ah,aj,ag){if(aj){json=Ext.decode(ag.responseText);if(json.success){info("success",json.message);try{if(dropEvent){dropEvent.target.parentNode.reload();dropEvent=null}}catch(ai){store.reload()}}else{Ext.Msg.alert("Failure",json.error)}}else{Ext.Msg.alert("Error","Failed to connect to the server.")}}})}}}function y(ae){var aa=dropEvent.data.selections,ac=[];if(aa){var ad=gridsearch.selModel.selections.keys;if(ad.length>0){var Z=gridsearch.selModel.getSelections();var af=gridsearch.selModel.getCount();for(i=0;i<af;i++){var ab=new Ext.data.Connection();ab.on("beforerequest",function(){Ext.MessageBox.wait(ae+" catalog ["+aa[i].data.title+"] to folder ["+dropEvent.target.text+"]")});ab.request({url:"./admin/api_folder/copy-move-items/format/json",params:{selitem:Z[i].json.guid,folderGuid:gridsearch.getSelectionModel().getSelected().data.folderGuid,targetGuid:dropEvent.target.id,act:ae,option:"grid"},callback:function(ah,ai,ag){if(ai){json=Ext.decode(ag.responseText);if(json.success){store.reload();info("Success",json.message)}else{Ext.Msg.alert("Failure",json.error)}}else{Ext.Msg.alert("Error","Failed to connect to the server.")}}});ab.on("requestcomplete",function(){Ext.MessageBox.hide()})}}}}function t(Z){a.showAt(Z.rawEvent.getXY())}function N(ab,ac,Z,aa){D(ac,aa)}function d(Z,aa){aa.stopEvent();aa.preventDefault();tree.getSelectionModel().select(Z);b.show(Z.ui.getAnchor())}function M(aa,Z){var ab=tree.getSelectionModel().getSelectedNode();var ac=ab.text.trim().charAt(0).toLowerCase()+ab.text.trim().substr(1).toLowerCase().replace(" ","");if(ab.text=="Tanggapan"){loadTab("./admin/comment_manager/comment",ab.text)}else{if(ab.text=="Approved"){loadTab("./admin/clinic_manager/clinic/status/1","Klinik")}else{if(ab.text=="Draft"){loadTab("./admin/clinic_manager/clinic/status/0","Klinik")}else{if(ab.text=="NA"){loadTab("./admin/clinic_manager/clinic/status/2","Klinik")}else{if(ab.text=="Published"){loadTab("./admin/clinic_manager/clinic/status/99","Klinik")}else{if(ab.text=="Event calendar"){loadTab("./admin/calendar_manager/eventcalendar","Calendar")}else{if(ab.text=="Banner"){loadTab("./admin/banner_manager/banner","Banner")}else{if(ab.text=="Polling"){loadTab("./admin/polling_manager/polling","Polling")}else{switch(tree.selModel.selNode.parentNode.text){case"Root":loadTab("../../app/servers/"+ac+"/manager/"+ac,ab.text);break;case"User":loadTab("./admin/membership_manager/"+ac,ab.text);break;case"Promotion":loadTab("widget/promomanager/"+ac,ab.text);break;case"Setting":ext_get("../../app/servers/setting/manager/setting/folderGuid/"+ab.id,750,500);break;default:tabpanel.activate(Ext.getCmp("main-view"));store.baseParams={folderGuid:ab.id};store.load({params:{start:0,limit:25,folderGuid:ab.id}})}}}}}}}}}}function k(ab,aa){if(!aa){return}try{if(tree.selModel.selNode.text=="Tanggapan"){return}else{if(tree.selModel.selNode.text=="Approved"){return}else{if(tree.selModel.selNode.text=="NA"){return}else{if(tree.selModel.selNode.text=="Draft"){return}else{if(tree.selModel.selNode.text=="Published"){return}else{if(tree.selModel.selNode.text=="Event calendar"){return}else{if(tree.selModel.selNode.text=="Banner"){return}else{switch(tree.selModel.selNode.parentNode.text){case"User":return;break;case"Promotion":return;break;case"Setting":return;break;default:tabpanel.activate(Ext.getCmp("main-view"));store.baseParams={folderGuid:aa.id};store.load({params:{start:0,limit:25,folderGuid:aa.id}});chDir(aa.id)}}}}}}}}}catch(Z){}}chDir=function(Z){Ext.Ajax.request({url:"./api/folder/chdir-event",params:{dir:Z},callback:function(ac,ad,ab){if(ad){var aa=Ext.decode(ab.responseText);Ext.get("chdir").update("Location : &nbsp;&nbsp;"+aa.dirselect)}}});o(null,Z)};function o(aa,Z){aa=tree.getNodeById(Z);if(!aa){return}if(aa.isExpanded()){aa.select();return}aa.on("load",function(){aa.select()});aa.expand}function D(ab,Z){var aa=tree.selModel.selNode;if(ab.hasChildNodes()){Ext.MessageBox.show({title:"Confirm",msg:"Attention!! Are you sure you want to move this folder '"+ab.text+"' into '"+Z.text+"' and move all its content ?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.WARNING,fn:function(ac){if(ac=="yes"){Ext.Ajax.request({url:"./admin/dms_foldermanager/node/folderGuid/"+ab.id+"/parentGuid/"+Z.id,success:function(){Ext.MessageBox.alert("Status","Move "+ab.text+" successfully.")}})}else{Ext.MessageBox.alert("Status","Move canceled.")}tree.root.reload()}})}else{Ext.MessageBox.show({title:"Confirm",msg:"You're about to move this folder '"+ab.text+"' into '"+Z.text+"'. Continue ?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.WARNING,fn:function(ac){if(ac=="yes"){Ext.Ajax.request({url:"./admin/dms_foldermanager/node/folderGuid/"+ab.id+"/parentGuid/"+Z.id,success:function(){Ext.MessageBox.alert("Status","Move "+ab.text+" successfully.");ab.parentNode.reload();ab.parentNode.select()}})}else{Ext.MessageBox.alert("Status","Move cancelled.");tree.root.reload()}}})}}function z(Z){b.hide();var aa=tree.getSelectionModel().getSelectedNode();switch(Z.id){case"exp":tree.expandAll();break;case"coll":tree.collapseAll();break;case"reload":tree.root.reload();break}}function r(Z,ad){if(ad){var ab=Ext.getCmp("right-preview");var ac=Ext.getCmp("right-search-preview");var ae=Ext.getCmp("bottom-preview");var aa=Ext.getCmp("bottom-search-preview");switch(Z.text){case"Bottom":ab.hide();ac.hide();ae.add(E);aa.add(A);ae.show();aa.show();ae.ownerCt.doLayout();aa.ownerCt.doLayout();break;case"Right":ae.hide();aa.hide();ab.add(E);ac.add(A);ab.show();ac.show();ab.ownerCt.doLayout();ac.ownerCt.doLayout();break;case"Hide":E.ownerCt.hide();A.ownerCt.hide();E.ownerCt.ownerCt.doLayout();A.ownerCt.ownerCt.doLayout();break}}}loadTab=function(aa,ad){var ae="kutu-"+ad;var ab=tabpanel.getComponent(ae);var Z={url:aa,scripts:true};if(ab){tabpanel.remove(ae,true);n=tabpanel.add({id:ae,cclass:ad,autoLoad:Z,title:ad,closable:true,layout:"fit"});tabpanel.setActiveTab(n)}else{var ac=tabpanel.add({id:ae,cclass:ad,autoLoad:Z,title:ad,closable:true,layout:"fit"});tabpanel.setActiveTab(ac)}};function m(Z){Z=(Z&&Z.data)?Z:grid.getSelectionModel().getSelected();var ad=Z.data;var ac=tree.getSelectionModel().getSelectedNode();var ae=ad.title;var aa={url:"./admin/browser/view-in-new-tab",params:{catalogGuid:ad.guid,folderGuid:ac.id},scripts:true};var ab;if(!(ab=tabpanel.getItem(ae))){ab=new Ext.Panel({id:ae,cls:"preview single-preview",title:ad.title,tabTip:ad.title,autoLoad:aa,closable:true,autoScroll:true,border:true,tbar:[{text:"Catalog",iconCls:"catalog",menu:new Ext.menu.Menu({items:[{text:"Edit",handler:function(){ext_get("./admin/dms_catalogmanager/edit/catalogGuid/"+ad.guid,750,500)}},{text:"Upload File(s)",handler:function(){ext_get("./admin/dms_fileuploader/add/catalogGuid/"+ad.guid,580,430)}},{text:"Add Relation",iconCls:"relation",handler:function(){ext_get("./admin/widgets_relation/viewsearch/guid/"+ad.guid,830,500,"viewsearch")}}]})}]});tabpanel.add(ab)}tabpanel.setActiveTab(ab)}function f(Z){Z=(Z&&Z.data)?Z:gridsearch.getSelectionModel().getSelected();var ac=Z.data;var ad=ac.title;var aa={url:"./admin/browser/view-in-new-tab",params:{catalogGuid:ac.guid,folderGuid:ac.folderGuid},scripts:true};var ab;if(!(ab=tabpanel.getItem(ad))){ab=new Ext.Panel({id:ad,cls:"preview single-preview",title:ac.title,tabTip:ac.title,autoLoad:aa,closable:true,autoScroll:true,border:true,tbar:[{text:"Catalog",iconCls:"catalog",menu:new Ext.menu.Menu({items:[{text:"Edit",handler:function(){ext_get("./admin/dms_catalogmanager/edit/catalogGuid/"+ac.guid,750,500)}},{text:"Upload File(s)",handler:function(){ext_get("./admin/dms_fileuploader/add/catalogGuid/"+ac.guid,580,430)}},{text:"Add Relation",iconCls:"relation",handler:function(){ext_get("./admin/widgets_relation/viewsearch/guid/"+ac.guid,830,500,"viewsearch")}}]})}]});tabpanel.add(ab)}tabpanel.setActiveTab(ab)}function L(){tabpanel.beginUpdate();grid.store.data.each(m,tabpanel);tabpanel.endUpdate()}function V(){tabpanel.beginUpdate();gridsearch.store.data.each(f,tabpanel);tabpanel.endUpdate()}}if(Ext.isIE){Ext.EventManager.addListener(window,"load",ext_init)}else{Ext.QuickTips.init();Ext.onReady(ext_init)};